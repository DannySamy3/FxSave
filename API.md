# API Documentation

## Overview

The Gold Price Prediction system exposes a simple REST API for accessing predictions. The API is read-only and returns data from the JSON file generated by the Python backend.

## Base URL

```
http://localhost:3000/api
```

## Endpoints

### 1. Get Latest Prediction

**Endpoint:**

```
GET /api/predict
```

**Description:**
Returns the latest Gold price direction prediction with confidence level and metadata.

**Response (200 OK):**

```json
{
  "prediction": "UP",
  "confidence": 57.23,
  "probability_down": 42.77,
  "probability_up": 57.23,
  "current_price": 2156.45,
  "timestamp": "2024-01-10 15:30:00",
  "model_version": "XGBoost v1.0",
  "generated_at": "2024-01-10 16:45:30 UTC"
}
```

**Response Fields:**

| Field              | Type   | Description                                        |
| ------------------ | ------ | -------------------------------------------------- |
| `prediction`       | string | Direction forecast: "UP" or "DOWN"                 |
| `confidence`       | number | Confidence percentage (0-100)                      |
| `probability_down` | number | Probability of DOWN movement (%)                   |
| `probability_up`   | number | Probability of UP movement (%)                     |
| `current_price`    | number | Current Gold price in USD                          |
| `timestamp`        | string | Time of the last candlestick (YYYY-MM-DD HH:MM:SS) |
| `model_version`    | string | Version of the ML model                            |
| `generated_at`     | string | When the prediction was generated (UTC)            |

**Error Responses:**

404 Not Found:

```json
{
  "error": "Prediction file not found",
  "message": "Please run \"python predict.py\" in the python_model directory to generate predictions.",
  "file_path": "/path/to/latest_prediction.json"
}
```

500 Internal Server Error:

```json
{
  "error": "Failed to read prediction",
  "message": "Error details here"
}
```

**Caching:**

- Responses are cached for 1 hour (Cache-Control: public, max-age=3600)
- Can be used stale for up to 24 hours if fresh data unavailable

**Example Usage (JavaScript):**

```javascript
// Fetch latest prediction
async function getPrediction() {
  try {
    const response = await fetch("/api/predict");

    if (!response.ok) {
      const error = await response.json();
      console.error("Error:", error.message);
      return null;
    }

    const data = await response.json();
    console.log(`Prediction: ${data.prediction}`);
    console.log(`Confidence: ${data.confidence}%`);
    console.log(`Gold Price: $${data.current_price}`);

    return data;
  } catch (error) {
    console.error("Fetch failed:", error);
    return null;
  }
}

getPrediction();
```

**Example Usage (Python):**

```python
import requests
import json

response = requests.get('http://localhost:3000/api/predict')
prediction = response.json()

print(f"Prediction: {prediction['prediction']}")
print(f"Confidence: {prediction['confidence']}%")
print(f"Gold Price: ${prediction['current_price']}")
```

**Example Usage (cURL):**

```bash
curl http://localhost:3000/api/predict

# Pretty print the JSON
curl http://localhost:3000/api/predict | jq .

# Get just the prediction
curl http://localhost:3000/api/predict | jq .prediction
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python Backend    â”‚
â”‚  predict.py        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ latest_prediction  â”‚
â”‚ .json (on disk)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js API       â”‚
â”‚  /api/predict      â”‚ (reads JSON file)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend / Client â”‚
â”‚  HTTP GET request  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Integration Examples

### 1. Integrate with Python

```python
#!/usr/bin/env python3
import requests
import json
from datetime import datetime

def get_gold_prediction():
    """Fetch latest Gold prediction from Next.js API"""
    url = 'http://localhost:3000/api/predict'

    try:
        response = requests.get(url, timeout=5)
        response.raise_for_status()

        prediction = response.json()

        # Use the prediction
        direction = prediction['prediction']
        confidence = prediction['confidence']
        price = prediction['current_price']

        print(f"[{datetime.now()}] Gold: {direction} ({confidence}% confidence)")
        print(f"Current Price: ${price}")

        # Your trading logic here
        if direction == 'UP' and confidence > 55:
            print("âœ“ Strong buy signal detected")
        elif direction == 'DOWN' and confidence > 55:
            print("âœ— Strong sell signal detected")

        return prediction

    except requests.exceptions.RequestException as e:
        print(f"Error fetching prediction: {e}")
        return None

if __name__ == '__main__':
    get_gold_prediction()
```

### 2. Integrate with Trading Bot

```python
# pseudo-code for trading bot integration
class GoldTradingBot:
    def __init__(self, api_url='http://localhost:3000/api/predict'):
        self.api_url = api_url

    def get_signal(self):
        """Get trading signal from prediction API"""
        response = requests.get(self.api_url)
        prediction = response.json()
        return prediction

    def execute_trade(self):
        signal = self.get_signal()

        if signal['prediction'] == 'UP':
            confidence = signal['confidence']

            if confidence > 60:
                # Strong signal - 2% risk
                self.buy_gold(risk_percent=2)
            elif confidence > 55:
                # Moderate signal - 1% risk
                self.buy_gold(risk_percent=1)

        elif signal['prediction'] == 'DOWN':
            confidence = signal['confidence']

            if confidence > 60:
                # Strong signal - 2% risk
                self.sell_gold(risk_percent=2)
            elif confidence > 55:
                # Moderate signal - 1% risk
                self.sell_gold(risk_percent=1)

        else:
            # No clear signal
            self.hold()

    def buy_gold(self, risk_percent):
        # Your trading API call here
        pass

    def sell_gold(self, risk_percent):
        # Your trading API call here
        pass

    def hold(self):
        # Do nothing
        pass
```

### 3. Integrate with Telegram Bot

```python
import requests
from telegram import Bot
from datetime import datetime

class GoldPredictionTelegramBot:
    def __init__(self, token, api_url='http://localhost:3000/api/predict'):
        self.bot = Bot(token=token)
        self.api_url = api_url

    async def send_daily_prediction(self, chat_id):
        """Send daily prediction to Telegram"""
        response = requests.get(self.api_url)
        prediction = response.json()

        message = f"""
        ðŸ¥‡ Gold Prediction Update

        Direction: {prediction['prediction']} {'ðŸ“ˆ' if prediction['prediction'] == 'UP' else 'ðŸ“‰'}
        Confidence: {prediction['confidence']}%
        Price: ${prediction['current_price']}

        Updated: {prediction['generated_at']}
        """

        await self.bot.send_message(chat_id=chat_id, text=message)

# Usage
bot = GoldPredictionTelegramBot(token='YOUR_BOT_TOKEN')
# Schedule to run daily: bot.send_daily_prediction(chat_id='YOUR_CHAT_ID')
```

## Rate Limiting & Performance

- **No rate limiting** - unlimited requests
- **Response time**: <50ms (file read from disk)
- **Data freshness**: Depends on when `predict.py` was last run
- **Availability**: 100% if file exists, offline-capable

## Best Practices

1. **Caching**: Cache responses locally to reduce disk I/O
2. **Error Handling**: Always handle network errors gracefully
3. **Timing**: Run `predict.py` before market hours for fresh signals
4. **Validation**: Check confidence > 55% before trading
5. **Risk Management**: Never risk more than 1-2% per trade
6. **Monitoring**: Log all trades and track accuracy monthly

## Troubleshooting

**API returns 404:**

- Run `python predict.py` in the python_model directory
- Ensure `public/latest_prediction.json` exists

**API returns 500:**

- Check Next.js server logs
- Verify file permissions on `latest_prediction.json`

**Stale data:**

- Check `generated_at` timestamp in response
- Run `python predict.py` again to refresh

---

**API Version**: 1.0  
**Last Updated**: January 2026
